# ğŸ—ï¸ System Architecture

Visual overview of the RAPART MobSF Analysis System.

---

## ğŸ¯ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RAPART MobSF Analysis System                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         API Server (Bun)              â”‚
         â”‚    http://localhost:8000              â”‚
         â”‚                                       â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
         â”‚  â”‚    REST API (Hono)          â”‚     â”‚
         â”‚  â”‚  - GET /get                 â”‚     â”‚
         â”‚  â”‚  - POST /post               â”‚     â”‚
         â”‚  â”‚  - PUT /put                 â”‚     â”‚
         â”‚  â”‚  - POST /add-batch          â”‚     â”‚
         â”‚  â”‚  - GET /stats               â”‚     â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â”‚                                       â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
         â”‚  â”‚   SQLite Database           â”‚     â”‚
         â”‚  â”‚   (WAL mode)                â”‚     â”‚
         â”‚  â”‚   - Task queue              â”‚     â”‚
         â”‚  â”‚   - Status tracking         â”‚     â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â”‚                                       â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
         â”‚  â”‚   File Storage              â”‚     â”‚
         â”‚  â”‚   - storage/apk/            â”‚     â”‚
         â”‚  â”‚   - storage/reports/        â”‚     â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–²
                        â”‚
                        â”‚ HTTP (LAN)
                        â”‚
                        â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      Scanner (Python)                 â”‚
         â”‚                                       â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
         â”‚  â”‚  Main Loop (main.py)        â”‚     â”‚
         â”‚  â”‚  - Get hash from API        â”‚     â”‚
         â”‚  â”‚  - Download APK             â”‚â—€â”€â”€â”€â”€â”¼â”€â”€â”€ AndroZoo API
         â”‚  â”‚  - Upload & Scan            â”‚     â”‚
         â”‚  â”‚  - Download report          â”‚     â”‚
         â”‚  â”‚  - Update status            â”‚     â”‚
         â”‚  â”‚  - Upload files             â”‚     â”‚
         â”‚  â”‚  - Cleanup                  â”‚     â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â”‚                                       â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
         â”‚  â”‚  Temp Storage               â”‚     â”‚
         â”‚  â”‚  - temp/malware/            â”‚     â”‚
         â”‚  â”‚  - temp/reports/            â”‚     â”‚
         â”‚  â”‚  (auto-deleted)             â”‚     â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ HTTP (localhost)
                        â”‚
                        â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      MobSF (Docker)                   â”‚
         â”‚    http://localhost:8000              â”‚
         â”‚                                       â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
         â”‚  â”‚  Static Analysis Engine     â”‚     â”‚
         â”‚  â”‚  - APK decompilation        â”‚     â”‚
         â”‚  â”‚  - Manifest analysis        â”‚     â”‚
         â”‚  â”‚  - Code analysis            â”‚     â”‚
         â”‚  â”‚  - Permission analysis      â”‚     â”‚
         â”‚  â”‚  - Security assessment      â”‚     â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â”‚                                       â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
         â”‚  â”‚  API Endpoints              â”‚     â”‚
         â”‚  â”‚  - POST /api/v1/upload      â”‚     â”‚
         â”‚  â”‚  - POST /api/v1/scan        â”‚     â”‚
         â”‚  â”‚  - POST /api/v1/report_json â”‚     â”‚
         â”‚  â”‚  - POST /api/v1/delete_scan â”‚     â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Processing Pipeline                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User/Script
    â”‚
    â”‚ 1. Add tasks
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /add-batchâ”‚
â”‚  {hashes: [...]}â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Databaseâ”‚
    â”‚ Queue  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 2. Get next
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GET /get â”‚
    â”‚{hash, id}â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Download from     â”‚
    â”‚AndroZoo          â”‚
    â”‚(SHA256)          â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ .apk file
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Upload to MobSF   â”‚
    â”‚POST /upload      â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ {hash: md5}
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Scan with MobSF   â”‚
    â”‚POST /scan        â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Analysis running...
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Download Report   â”‚
    â”‚POST /report_json â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ .json file
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Update Status     â”‚
    â”‚POST /post        â”‚
    â”‚{hash, "success"} â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Upload Files      â”‚
    â”‚PUT /put          â”‚
    â”‚(apk + report)    â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Files saved
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Delete MobSF Scan â”‚
    â”‚POST /delete_scan â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Delete Local Filesâ”‚
    â”‚(temp/*.apk)      â”‚
    â”‚(temp/*.json)     â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ âœ… Complete
          â”‚
          â”‚ Loop back to step 2
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚
                                 â–¼
                            Next hash...
```

---

## ğŸ”„ State Machine

```
Task Status State Transitions:

         [Created]
             â”‚
             â”‚ (Task added to database)
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ pending â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚
             â”‚ (Scanner calls GET /get)
             â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ processing â”‚
      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                     â”‚              â”‚              â”‚
            â”‚ (Success)           â”‚ (Fail)       â”‚ (Fail)       â”‚ (Fail)
            â–¼                     â–¼              â–¼              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ success â”‚         â”‚download_failedâ”‚ â”‚scan_failedâ”‚ â”‚  error   â”‚
       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚              â”‚              â”‚
            â”‚ (Upload files)      â”‚              â”‚              â”‚
            â–¼                     â”‚              â”‚              â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚              â”‚              â”‚
       â”‚uploaded â”‚               â”‚              â”‚              â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚              â”‚              â”‚
            â”‚                     â”‚              â”‚              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                            [Terminated]
```

---

## ğŸ—„ï¸ Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      tasks table                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Column          â”‚ Type       â”‚ Description              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id              â”‚ INTEGER PK â”‚ Auto-increment ID        â”‚
â”‚ hash            â”‚ TEXT UNIQUEâ”‚ SHA256 hash (64 chars)   â”‚
â”‚ status          â”‚ TEXT       â”‚ Current status           â”‚
â”‚ label           â”‚ TEXT       â”‚ 'malware' or 'benign'    â”‚
â”‚ created_at      â”‚ DATETIME   â”‚ Task creation time       â”‚
â”‚ updated_at      â”‚ DATETIME   â”‚ Last update time         â”‚
â”‚ processed_at    â”‚ DATETIME   â”‚ Completion time          â”‚
â”‚ apk_path        â”‚ TEXT       â”‚ Stored APK path          â”‚
â”‚ report_path     â”‚ TEXT       â”‚ Stored report path       â”‚
â”‚ error_message   â”‚ TEXT       â”‚ Error details (if any)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Indexes:
- PRIMARY KEY on id
- UNIQUE INDEX on hash
- INDEX on status (for queue queries)
```

---

## ğŸ”Œ API Integration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              External Service Integration               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. AndroZoo API
   â”œâ”€ URL: https://androzoo.uni.lu/api/download
   â”œâ”€ Method: GET
   â”œâ”€ Params: apikey, sha256
   â””â”€ Response: Binary APK file

2. MobSF API
   â”œâ”€ Upload
   â”‚  â”œâ”€ URL: http://localhost:8000/api/v1/upload
   â”‚  â”œâ”€ Method: POST
   â”‚  â”œâ”€ Body: multipart/form-data (file)
   â”‚  â””â”€ Response: {hash: "md5", scan_type: "apk"}
   â”‚
   â”œâ”€ Scan
   â”‚  â”œâ”€ URL: http://localhost:8000/api/v1/scan
   â”‚  â”œâ”€ Method: POST
   â”‚  â”œâ”€ Body: {hash: "md5", scan_type: "apk"}
   â”‚  â””â”€ Response: JSON (scan results)
   â”‚
   â”œâ”€ Report
   â”‚  â”œâ”€ URL: http://localhost:8000/api/v1/report_json
   â”‚  â”œâ”€ Method: POST
   â”‚  â”œâ”€ Body: {hash: "md5"}
   â”‚  â””â”€ Response: JSON (detailed report)
   â”‚
   â””â”€ Delete
      â”œâ”€ URL: http://localhost:8000/api/v1/delete_scan
      â”œâ”€ Method: POST
      â”œâ”€ Body: {hash: "md5"}
      â””â”€ Response: {deleted: "yes"}

3. RAPART API Server (Internal)
   â””â”€ See "REST API Endpoints" section
```

---

## ğŸ“¦ Component Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Dependency Graph                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scanner (Python)
â”œâ”€â”€ requests (HTTP client)
â”œâ”€â”€ tqdm (progress bar)
â”œâ”€â”€ python-dotenv (config)
â”œâ”€â”€ pathlib (file paths)
â””â”€â”€ time (delays)
    â”‚
    â”œâ”€ Depends on â”€â–¶ API Server (Bun)
    â”œâ”€ Depends on â”€â–¶ MobSF (Docker)
    â””â”€ Depends on â”€â–¶ AndroZoo API

API Server (Bun)
â”œâ”€â”€ hono (web framework)
â”œâ”€â”€ bun:sqlite (database)
â””â”€â”€ bun (runtime)
    â”‚
    â””â”€ Depends on â”€â–¶ File system (storage/)

MobSF (Docker)
â””â”€â”€ Docker Engine
    â”‚
    â””â”€ Provides â”€â–¶ Analysis service

AndroZoo
â””â”€â”€ External service
    â”‚
    â””â”€ Provides â”€â–¶ APK files
```

---

## ğŸš€ Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Recommended Deployment Setup                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Kali Linux VM (80 GB disk)                      â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Docker Container: MobSF                        â”‚   â”‚
â”‚  â”‚  Port: 8000                                     â”‚   â”‚
â”‚  â”‚  Volume: /root/.MobSF                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Scanner Process                                â”‚   â”‚
â”‚  â”‚  - Downloads APKs (temp)                        â”‚   â”‚
â”‚  â”‚  - Scans with MobSF                             â”‚   â”‚
â”‚  â”‚  - Uploads to API server                        â”‚   â”‚
â”‚  â”‚  - Deletes local files                          â”‚   â”‚
â”‚  â”‚  Max disk usage: ~200 MB                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         â”‚
         â”‚ LAN (HTTP)
         â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Storage Server / Development Machine            â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  API Server Process (Bun)                       â”‚   â”‚
â”‚  â”‚  Port: 8000                                     â”‚   â”‚
â”‚  â”‚  - Task queue management                        â”‚   â”‚
â”‚  â”‚  - File storage (grows continuously)            â”‚   â”‚
â”‚  â”‚  - Database: SQLite                             â”‚   â”‚
â”‚  â”‚                                                  â”‚   â”‚
â”‚  â”‚  storage/                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ apk/     (~50 GB per 1000 APKs)           â”‚   â”‚
â”‚  â”‚  â””â”€â”€ reports/ (~2 GB per 1000 reports)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ Performance Characteristics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Performance Metrics                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Processing Rate (Single-threaded):
â”œâ”€â”€ Best case:  30 APKs/hour  (2 min/APK)
â”œâ”€â”€ Average:    20 APKs/hour  (3 min/APK)
â””â”€â”€ Worst case: 12 APKs/hour  (5 min/APK)

Bottlenecks:
â”œâ”€â”€ 1. MobSF scan time        (60-180 seconds)
â”œâ”€â”€ 2. APK download speed     (depends on AndroZoo)
â”œâ”€â”€ 3. LAN upload speed       (for 50-100 MB files)
â””â”€â”€ 4. Disk I/O              (minimal impact)

Disk Usage:
â”œâ”€â”€ Scanner (temp):           100-200 MB max
â”œâ”€â”€ API Server (permanent):   ~52 GB per 1000 APKs
â””â”€â”€ MobSF (container):        Grows until cleanup

Network Traffic:
â”œâ”€â”€ Download (per APK):       5-50 MB (from AndroZoo)
â”œâ”€â”€ Upload (per APK):         5-50 MB (to API server)
â”œâ”€â”€ Upload (per report):      1-5 MB (to API server)
â””â”€â”€ Total per APK:            ~10-100 MB
```

---

## ğŸ”’ Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Security Layers                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: Network Isolation
â”œâ”€â”€ API Server: LAN only (no public internet)
â”œâ”€â”€ MobSF: localhost only (port 8000)
â””â”€â”€ Scanner: VM isolated environment

Layer 2: Process Isolation
â”œâ”€â”€ MobSF: Runs in Docker container
â”œâ”€â”€ Scanner: Single-threaded, controlled execution
â””â”€â”€ API Server: Separate process

Layer 3: File Handling
â”œâ”€â”€ Malware files: Never executed directly
â”œâ”€â”€ Temporary storage: Auto-deleted
â””â”€â”€ Permanent storage: Quarantine location

Layer 4: API Security
â”œâ”€â”€ No authentication (LAN trust model)
â”œâ”€â”€ Input validation (hash format, status values)
â””â”€â”€ Rate limiting: N/A (single client)

Threat Model:
â”œâ”€â”€ âœ… Malware cannot escape Docker
â”œâ”€â”€ âœ… Files deleted from scanner after upload
â”œâ”€â”€ âœ… No public internet exposure
â””â”€â”€ âš ï¸  API server has no authentication (LAN only)
```

---

## ğŸ¯ Scalability Considerations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Scaling Strategies (Future)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Horizontal Scaling:
â”œâ”€â”€ Multiple scanner instances
â”‚   â”œâ”€â”€ Same API server
â”‚   â”œâ”€â”€ Task queue prevents duplicates
â”‚   â””â”€â”€ Coordination via database
â”‚
â”œâ”€â”€ Multiple MobSF instances
â”‚   â”œâ”€â”€ Different ports (8001, 8002, ...)
â”‚   â”œâ”€â”€ Load balancing via scanner
â”‚   â””â”€â”€ Parallel processing
â”‚
â””â”€â”€ Distributed storage
    â”œâ”€â”€ NAS/SAN for API server
    â””â”€â”€ Shared file system

Vertical Scaling:
â”œâ”€â”€ More CPU/RAM for MobSF
â”œâ”€â”€ Faster disk I/O (SSD)
â””â”€â”€ Higher network bandwidth

Current Limitations:
â”œâ”€â”€ Single-threaded scanner (by design)
â”œâ”€â”€ SQLite (not optimized for high concurrency)
â””â”€â”€ Local file storage (not distributed)
```

---

## ğŸ“Š Monitoring Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               System Monitoring                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

API Server:
â”œâ”€â”€ GET /stats
â”‚   â”œâ”€â”€ Total tasks
â”‚   â”œâ”€â”€ Tasks by status
â”‚   â””â”€â”€ Recent tasks
â”‚
â”œâ”€â”€ Server logs
â”‚   â”œâ”€â”€ HTTP requests
â”‚   â”œâ”€â”€ Status updates
â”‚   â””â”€â”€ File uploads
â”‚
â””â”€â”€ Database
    â””â”€â”€ Query: SELECT status, COUNT(*) FROM tasks GROUP BY status

Scanner:
â”œâ”€â”€ Console output
â”‚   â”œâ”€â”€ Hash received
â”‚   â”œâ”€â”€ Download progress
â”‚   â”œâ”€â”€ Scan status
â”‚   â”œâ”€â”€ Upload progress
â”‚   â””â”€â”€ Cleanup confirmation
â”‚
â””â”€â”€ Error messages
    â”œâ”€â”€ Download failures
    â”œâ”€â”€ Scan failures
    â””â”€â”€ Upload failures

MobSF:
â”œâ”€â”€ Docker logs
â”‚   â””â”€â”€ docker logs <container_id>
â”‚
â””â”€â”€ API responses
    â”œâ”€â”€ Upload status
    â”œâ”€â”€ Scan results
    â””â”€â”€ Delete confirmations

File System:
â”œâ”€â”€ Scanner temp/: du -sh temp/*
â”œâ”€â”€ API storage/: du -sh storage/*
â””â”€â”€ Database size: ls -lh data/tasks.db
```

---

This architecture supports processing thousands of Android malware samples
with minimal manual intervention and efficient resource usage.

**Status:** Production Ready âœ…
